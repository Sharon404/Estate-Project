Single Source of Truth (INTERNAL â€“ authoritative)
# Single Source of Truth (SSOT)

## 1. Purpose
This document is the authoritative reference for the Holiday Rental Booking & Payments System.
All development, feature chats, troubleshooting, and enhancements MUST align with this document.

No feature, file change, or architectural decision should contradict this SSOT.

---

## 2. System Overview
The system is a web-based holiday rental management platform that allows:
- Guests to book holiday rentals
- Partial or full payment via M-PESA
- Admin/staff to manage properties, bookings, payments, and amenities
- Secure tracking of all financial transactions with auditability

---

## 3. Technology Stack
- Backend: Laravel (latest LTS)
- Database: MySQL
- Frontend (Admin): Velzon HTML Template (Blade-based)
- UI Pattern: Blade views + Modals + Toast notifications
- Payments: M-PESA (STK Push + manual fallback)
- Mail: Laravel Mail (queued)
- Storage: Laravel filesystem (secured uploads)

---

## 4. Core Features (Feature Catalog)

### 4.1 User Management
- Roles:
  - Admin: full access
  - Staff: limited operational access
- Secure authentication
- Role-based authorization using policies/middleware

### 4.2 Property Management
- Create, edit, deactivate houses
- Upload multiple images per house
- Edit nightly rates and descriptions
- Images stored securely and validated

### 4.3 Booking Management
- System-generated booking reference
- Booking lifecycle:
  - DRAFT
  - PENDING_PAYMENT
  - PARTIALLY_PAID
  - PAID
  - CANCELLED
  - EXPIRED
- Booking expiry if unpaid after configurable time

### 4.4 Amenities & Add-ons
- Configurable amenities (e.g. massage, pool, transport)
- Flexible pricing models
- Attach amenities to bookings

### 4.5 Payments
- Partial payments supported
- M-PESA STK Push
- Manual M-PESA payment fallback
- Ledger-based accounting (no overwrites)
- Idempotent processing (no duplicate receipts)

### 4.6 Receipts & Notifications
- Receipt generated per successful payment
- Email confirmation sent to guest
- Admin can re-send receipts

---

## 5. UI & UX Rules
- Modals are used for:
  - Confirmation steps
  - Quick edits
  - Payment initiation
- Full pages are used for:
  - Data-heavy forms
  - File uploads
- Toast notifications are used for:
  - Success
  - Errors
  - Warnings
- Critical statuses must always be visible on the page (not toast-only)

---

## 6. Naming & Structure Conventions
- Routes grouped by domain: admin, bookings, payments
- Controllers: `Admin/`, `Booking/`, `Payment/`
- Models: singular, descriptive
- Views:
  - `resources/views/admin/...`
  - `resources/views/layouts/velzon/...`

---

## 7. Non-Negotiable Rules
- No payment is marked PAID without a ledger entry
- No admin page without authentication + authorization
- No secrets committed to the repository
- All requests validated using Form Requests
- All M-PESA callbacks stored before processing

---

## 8. Reference Policy
Every feature chat must:
1. Reference this SSOT
2. Respect the defined architecture
3. Update `/docs/CHANGELOG.md` after completion
